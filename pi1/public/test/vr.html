<!DOCTYPE html>
<html>

<head>
    <title>VR</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
        }

        canvas {
            width: 100%;
            height: 100%
        }
    </style>
    <script src="../three.min.js"></script>
    <script src="../WebVR.js"></script>
    <script>
        window.addEventListener('load', function () {
            var scene = new THREE.Scene();
            var camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 1, 2000);
            //camera.layers.enable(1); // render left view when no stereo available

            // video
            var video = document.getElementById('video');
            video.play();
            var texture = new THREE.Texture(video);
            texture.generateMipmaps = false;
            texture.minFilter = THREE.NearestFilter;
            texture.magFilter = THREE.NearestFilter;
            texture.format = THREE.RGBFormat;
            setInterval(function () {
                if (video.readyState >= video.HAVE_CURRENT_DATA) {
                    texture.needsUpdate = true;
                }
            }, 1000 / 24);

            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x101010);
            // left
            var geometry = new THREE.SphereBufferGeometry(500, 60, 40);
            // invert the geometry on the x-axis so that all of the faces point inward
            geometry.scale(- 1, 1, 1);
            var uvs = geometry.attributes.uv.array;
            for (var i = 0; i < uvs.length; i += 2) {
                uvs[i] *= 0.5;
            }
            var material = new THREE.MeshBasicMaterial({ map: texture });
            var mesh = new THREE.Mesh(geometry, material);
            mesh.rotation.y = - Math.PI / 2;
            //mesh.layers.set(1); // display in left eye only
            scene.add(mesh);

            var renderer = new THREE.WebGLRenderer();
            renderer.setPixelRatio( window.devicePixelRatio );
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.vr.enabled = true;
            document.body.appendChild(renderer.domElement);
            document.body.appendChild( WEBVR.createButton( renderer, { referenceSpaceType: 'local' } ) );

            window.addEventListener( 'resize', function() {
                camera.aspect = window.innerWidth / window.innerHeight;
				camera.updateProjectionMatrix();
				renderer.setSize( window.innerWidth, window.innerHeight );                
            }, false );

            renderer.setAnimationLoop(function() {
                renderer.render( scene, camera );
            });

        });
    </script>
</head>

<body>
    <video id="video" loop muted crossOrigin="anonymous" webkit-playsinline style="display:none">
        <source src="https://threejs.org/examples/textures/MaryOculus.webm">
        <source src="https://threejs.org/examples/textures/MaryOculus.mp4">
    </video>
</body>

</html>